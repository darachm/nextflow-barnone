// This stuff is defining the reports and things, so tracing the 
//   steps, making a report, a timeline, and a DAG of the steps.
trace {
  enabled = true
  file = "reports/nextflow_pipeline_trace.txt"
  fields = 'task_id,name,status,exit,realtime,%cpu,rss'
}
report {
  enabled = true
  file = "reports/nextflow_report.html"
}
timeline {
  enabled = true
  file = "reports/nextflow_timeline.html"
}
dag {
  enabled = true
  file = "reports/nextflow_dag.png"
}

// This defines what executes the steps. Note the weird dollar sign,
//   but there's some that are SLURM (so cluster), and some that are
//   kept local (moving a file).
executor {
  $slurm {
    clusterOptions='--mail-type=BEGIN,END,FAIL --mail-user=dhm267@nyu.edu'
  }
}

// Here's enabling the use of singularity containers.
//singularity {
//  enabled = true
//  cacheDir = "singularity"
//  autoMounts = true
//}

// This defines for processes the default of executing with slurm,
//   then specifics for different steps. Also, the use of singularity
//   containers it'll download and then use. It caches these.
// Note that the aggregate step is run locally, not slurmed.
process {
  executor="slurm"
  $gunzip {
    executor="local"
  }
  $sample {
    executor="local"
  }
  $barnone {
    cpus='1'
    time='2h'
    memory='30GB'
  }
//  $salmon_quant {
//    cpus='4'
//    time='15m'
//    memory='16GB'
//    container="shub://qbicsoftware/qbic-singularity-salmon:v0.8.2"
//  }
}


